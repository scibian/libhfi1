#!/usr/bin/make -f
# -*- mode: makefile; coding: utf-8 -*-

#export DH_VERBOSE=1
export DEB_BUILD_MAINT_OPTIONS=hardening=+all,-pie
LIBDIR=/usr/lib/$(DEB_HOST_MULTIARCH)

INSTALL_SPECS=debian/libhfi1.install \
	debian/libhfi1-dev.install

%:
	dh $@ --parallel --with autoreconf

debian/%.install: debian/%.install.in
	sed -e 's/@DEB_HOST_MULTIARCH@/$(DEB_HOST_MULTIARCH)/g' 	\
		$< > $@

.PHONY: override_dh_auto_clean
override_dh_auto_clean:

.PHONY: override_dh_auto_build
override_dh_auto_build: $(INSTALL_SPECS)
	dh_auto_build

.PHONY: override_dh_autoreconf
override_dh_autoreconf:
	if [ ! -f NEWS ] ; then > NEWS ; fi
	if [ ! -f ChangeLog ] ; then > ChangeLog ; fi
	dh_autoreconf

.PHONY: override_dh_auto_configure
override_dh_auto_configure:
	dh_auto_configure -- --prefix=/usr --sysconfdir=/etc --libdir=$(LIBDIR)

.PHONY: override_dh_auto_install
override_dh_auto_install:
	dh_auto_install
	sed 's~/usr/lib~$(LIBDIR)~' -i debian/tmp/etc/libibverbs.d/hfi1.driver

.PHONY: override_dh_installdocs
override_dh_installdocs:
	dh_installdocs --link-doc=libhfi1

# Prevent useless call to ldconfig for compat library
.PHONY: override_dh_makeshlibs
override_dh_makeshlibs:
	dh_makeshlibs -X$(LIBDIR)/libibverbs
